<!DOCTYPE HTML><html><head><meta charset="utf-8"><meta name="keywords" content="Copula III — Applications, CP DataStation"><meta name="description" content="In this post, we may quickly go through the applications for Copulas. Firstly, let’s talk about quantile regression base"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>Copula III — Applications | CP DataStation</title><link rel="icon" type="image/png" href="/en/favicon.png"><style>body{background-image:url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);background-repeat:no-repeat;background-size:100% 100%;background-attachment:fixed}@media (max-width:600px){body{background-image:none}}</style><link rel="stylesheet" href="/en/libs/awesome/css/all.min.css"><link rel="stylesheet" href="/en/libs/materialize/materialize.min.css"><link rel="stylesheet" href="/en/libs/aos/aos.css"><link rel="stylesheet" href="/en/libs/animate/animate.min.css"><link rel="stylesheet" href="/en/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="/en/css/matery.css"><link rel="stylesheet" href="/en/css/my.css"><link rel="stylesheet" href="/en/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="/en/libs/tocbot/tocbot.css"><link rel="stylesheet" href="/en/css/post.css"><link rel="stylesheet" href="/en/css/reward.css"><script src="/en/libs/jquery/jquery-3.6.0.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 7.1.1"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/en/" class="waves-effect waves-light"><img src="/en/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">CP DataStation</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/en/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>Index</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/en/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>Tags</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/en/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>Categories</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/en/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>Archives</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/en/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>About</span></a></li><li class="hide-on-med-and-down nav-item"><a href="https://zcpisme.github.io/" class="waves-effect waves-light"><i class="fas fa-language" style="zoom:.6"></i> <span>中文</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="Search" style="zoom:.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/en/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">CP DataStation</div><div class="logo-desc">Never really desperate, only the lost of the soul.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/en/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> Index</a></li><li class="m-nav-item"><a href="/en/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> Tags</a></li><li class="m-nav-item"><a href="/en/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> Categories</a></li><li class="m-nav-item"><a href="/en/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> Archives</a></li><li class="m-nav-item"><a href="/en/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> About</a></li><li class="m-nav-item"><a href="https://zcpisme.github.io/" class="waves-effect waves-light"><i class="fa-fw fas fa-language"></i> 中文</a></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/en/medias/featureimages/16.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Copula III — Applications</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/en/tags/Probability/"><span class="chip bg-color">Probability</span></a> <a href="/en/tags/Mathematics/"><span class="chip bg-color">Mathematics</span></a> <a href="/en/tags/Machine-Learning/"><span class="chip bg-color">Machine Learning</span></a> <a href="/en/tags/Linear-Nonlinear-Analysis/"><span class="chip bg-color">Linear &amp; Nonlinear Analysis</span></a> <a href="/en/tags/Data-Analysis/"><span class="chip bg-color">Data Analysis</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/en/categories/Mathematics/" class="post-category">Mathematics</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> Publish Date:&nbsp;&nbsp; 2024-03-17</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> Word Count:&nbsp;&nbsp; 1.8k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> Read Times:&nbsp;&nbsp; 11 Min</div></div></div><hr class="clearfix"><link rel="stylesheet" href="/en/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><p>In this post, we may quickly go through the applications for Copulas. Firstly, let’s talk about <strong>quantile regression</strong> based on Copula, and then move to a real-world case about <strong>anomalies detection</strong>.</p><h2 id="1-Quantile-Regression"><a href="#1-Quantile-Regression" class="headerlink" title="1, Quantile Regression"></a>1, Quantile Regression</h2><h3 id="Synthetic-Data"><a href="#Synthetic-Data" class="headerlink" title="Synthetic Data"></a>Synthetic Data</h3><p>Unfortunately, I do not find a good way to synthetic data in Python, but R does provide some great functions for Copulas. I’ll use R to generate artificial data, and use Python to do the quantile regression. (However, I highly recommend to use R to do everything because R is more sophisticated, and Python module about Copula is buggy.)</p><p>Suppose $X \sim \text{Norm(100, 4)}$, $Y \sim \text{Exponential(5)}$ with rotated Clayton Copula, then use R to generate and save results.</p><pre class="line-numbers language-R" data-language="R"><code class="language-R">library(copula)
library(MASS)

thetaClayton&lt;-6
copulaClayton_sim&lt;-claytonCopula(param&#x3D;thetaClayton,dim&#x3D;2)

simData&lt;- -rCopula(500,copulaClayton_sim)+1 #rotate the data for deeper understanding
plot(simData)

X&lt;-qexp(simData[,1],rate&#x3D;0.2)
Y&lt;-qnorm(simData[,2],mean &#x3D; 100, sd &#x3D; 4)
data &#x3D; cbind(X,Y)
write.csv(data, file &#x3D; &quot;synthetic_data.csv&quot;, row.names &#x3D; FALSE)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>In Python, check data distribution</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'synthetic_data.csv'</span><span class="token punctuation">)</span>
X <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span>
Y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span>

rate <span class="token operator">=</span> <span class="token number">0.2</span>

<span class="token comment"># Data for the normal distribution</span>
mu <span class="token operator">=</span> <span class="token number">100</span>
sigma <span class="token operator">=</span> <span class="token number">4</span>

fig<span class="token punctuation">,</span> axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>hist<span class="token punctuation">(</span>X<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> density<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">)</span>
xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get_xlim<span class="token punctuation">(</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> xmax<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> rate <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>rate <span class="token operator">*</span> x<span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"X, rate = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>rate<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Value'</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Density'</span><span class="token punctuation">)</span>


axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>hist<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> density<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'g'</span><span class="token punctuation">)</span>
xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get_xlim<span class="token punctuation">(</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> xmax<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">(</span>sigma <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span>x <span class="token operator">-</span> mu<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> sigma<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Y, mu = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mu<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">, std = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>sigma<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Value'</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Density'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/xys.png"></p><p><img src="/en/../images/6/xyc.png"></p><h3 id="Determine-Copula"><a href="#Determine-Copula" class="headerlink" title="Determine Copula"></a>Determine Copula</h3><p>Since we generated data from Clayton Copula, so we already know we should use Clayton copula. However, let’s imagine we do not know the process of generating data, which means we do not know which Copula type we should use, and we need to determine the Copula (for now, just consider Gaussian, Clayton and Frank).</p><p>Actually, we should also hypnotize that we do not know the information about the distribution for each variable, and we should use statistical method to estimate the parameter. For convenience, we just use the exact parameters.</p><p>The key is to plot the CDFs.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> expon<span class="token punctuation">,</span> norm

<span class="token comment"># Calculate the CDF for the given values</span>
U <span class="token operator">=</span> expon<span class="token punctuation">.</span>cdf<span class="token punctuation">(</span>X<span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
V <span class="token operator">=</span> norm<span class="token punctuation">.</span>cdf<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> loc<span class="token operator">=</span>mu<span class="token punctuation">,</span> scale<span class="token operator">=</span>sigma<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>U<span class="token punctuation">,</span>V<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'U'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'V'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/UV.png"></p><p><img src="/en/../images/5/clayCo.png" alt="Comparison to theoretical Clayton Copula"></p><p>By the CDF plot, it’s easy to determine the copula type, isn’t it? <strong>Yes, Clayton!</strong> Here, we just have a rotated Clayton pattern.</p><p>We can rotate the data by <code>-U + 1</code> and <code>-V + 1</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">empCopula <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>U<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">)</span>
empCopula_rotated <span class="token operator">=</span> <span class="token operator">-</span>empCopula <span class="token operator">+</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Fit-Clayton-Copula"><a href="#Fit-Clayton-Copula" class="headerlink" title="Fit Clayton Copula"></a>Fit Clayton Copula</h3><p>If you haven’t installed <a target="_blank" rel="noopener" href="https://sdv.dev/Copulas/index.html">copulas in python</a>, use <code>pip install copulas</code> to install.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> copulas<span class="token punctuation">.</span>bivariate <span class="token keyword">import</span> Bivariate<span class="token punctuation">,</span> CopulaTypes

clayton <span class="token operator">=</span> Bivariate<span class="token punctuation">(</span>copula_type<span class="token operator">=</span>CopulaTypes<span class="token punctuation">.</span>CLAYTON<span class="token punctuation">)</span> <span class="token comment">#specify clayton copula</span>
clayton<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>empCopula_rotated<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Create-quantile-regression-line"><a href="#Create-quantile-regression-line" class="headerlink" title="Create quantile regression line"></a>Create quantile regression line</h3><p>Usually, we are interested in 5%(lower), 50%(median) and 95%(upper) quantiles.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">theta <span class="token operator">=</span> clayton<span class="token punctuation">.</span>theta

alpha<span class="token operator">=</span><span class="token number">.05</span>
quantileLow<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>alpha<span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span>theta<span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>theta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> empCopula_rotated<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span>theta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>theta<span class="token punctuation">)</span>

alpha<span class="token operator">=</span><span class="token number">.5</span>
quantileMid<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>alpha<span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span>theta<span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>theta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> empCopula_rotated<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span>theta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>theta<span class="token punctuation">)</span>

alpha<span class="token operator">=</span><span class="token number">.95</span>
quantileHigh<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>alpha<span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span>theta<span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>theta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> empCopula_rotated<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span>theta<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>theta<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>empCopula_rotated<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> empCopula_rotated<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Empirical Copula'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>empCopula_rotated<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> quantileLow<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"orange"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Quantile Low'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>empCopula_rotated<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> quantileMid<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"orange"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Quantile Low'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>empCopula_rotated<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> quantileHigh<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"orange"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Quantile Low'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/regre1.png" alt="Quantile regression"></p><h3 id="Transform-results-to-original-data"><a href="#Transform-results-to-original-data" class="headerlink" title="Transform results to original data"></a>Transform results to original data</h3><p>The result above looks great, but we cannot understand this for original X and Y, so we need one more step to let regression line fit the original data.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">quantilesLowMidHigh <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">'Low'</span><span class="token punctuation">:</span> quantileLow<span class="token punctuation">,</span>
    <span class="token string">'Mid'</span><span class="token punctuation">:</span> quantileMid<span class="token punctuation">,</span>
    <span class="token string">'High'</span><span class="token punctuation">:</span> quantileHigh
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

mean <span class="token operator">=</span> <span class="token number">100</span>
sd <span class="token operator">=</span> <span class="token number">4</span>

<span class="token comment"># Define the function to be applied</span>
<span class="token keyword">def</span> <span class="token function">transform_quantiles</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> norm<span class="token punctuation">.</span>ppf<span class="token punctuation">(</span><span class="token operator">-</span>z <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> loc<span class="token operator">=</span>mean<span class="token punctuation">,</span> scale<span class="token operator">=</span>sd<span class="token punctuation">)</span>

<span class="token comment"># Apply the function to each column</span>
reconstrQuantiles <span class="token operator">=</span> quantilesLowMidHigh<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> z<span class="token punctuation">:</span> transform_quantiles<span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Original Data'</span><span class="token punctuation">)</span>

<span class="token comment"># Add reconstructed quantiles points</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">,</span> reconstrQuantiles<span class="token punctuation">[</span><span class="token string">'Low'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'orange'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Low Quantile'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">,</span> reconstrQuantiles<span class="token punctuation">[</span><span class="token string">'Mid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Mid Quantile'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">,</span> reconstrQuantiles<span class="token punctuation">[</span><span class="token string">'High'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'High Quantile'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Predictor'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Output'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/regref.png" alt="Looks cool!"></p><h2 id="2-Anomalies-Detection"><a href="#2-Anomalies-Detection" class="headerlink" title="2, Anomalies Detection"></a>2, Anomalies Detection</h2><p>Now let’s dive into a real-world data. In Miami, FL, our experience tells us higher air temperature leads to more precipitable water since more water evaporates. <a target="_blank" rel="noopener" href="https://psl.noaa.gov/data/gridded/data.ncep.reanalysis2.html">NOAA Physical Sciences Laboratory (PSL)</a> provides monthly air temperate (air.mon.mean.nc) and precipitable water (pr_wtr.eatm.mon.mean.nc) data, and we can download data from their website. Until now, the data is from 1979 to 2024.</p><h3 id="Read-the-data"><a href="#Read-the-data" class="headerlink" title="Read the data"></a>Read the data</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> netCDF4 <span class="token keyword">as</span> nc
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># Load netCDF file (Temperature)</span>
temp_ds <span class="token operator">=</span> nc<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span><span class="token string">'air.mon.mean.nc'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>

<span class="token comment"># Load netCDF file (Precipitable water)</span>
water_ds <span class="token operator">=</span> nc<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span><span class="token string">'pr_wtr.eatm.mon.mean.nc'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>

<span class="token comment"># Coordinates for Miami, FL</span>
lon <span class="token operator">=</span> <span class="token number">279.8082</span>  <span class="token comment"># Converted longitude for Miami</span>
lat <span class="token operator">=</span> <span class="token number">25.7617</span>   <span class="token comment"># Latitude for Miami</span>

<span class="token comment"># Finding the nearest longitude and latitude indices</span>
<span class="token keyword">def</span> <span class="token function">find_nearest</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    array <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>array<span class="token punctuation">)</span>
    idx <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>array <span class="token operator">-</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argmin<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> idx<span class="token punctuation">,</span> array<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>

idxLon<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_nearest<span class="token punctuation">(</span>temp_ds<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">'lon'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lon<span class="token punctuation">)</span>
idxLat<span class="token punctuation">,</span> _ <span class="token operator">=</span> find_nearest<span class="token punctuation">(</span>temp_ds<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">'lat'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lat<span class="token punctuation">)</span>

<span class="token comment"># Normalize temperature data</span>
<span class="token keyword">def</span> <span class="token function">normalize_data</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> dates<span class="token punctuation">)</span><span class="token punctuation">:</span>
    monthly_means <span class="token operator">=</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>data<span class="token punctuation">[</span>dates <span class="token operator">==</span> month<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> month <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    monthly_sds <span class="token operator">=</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>data<span class="token punctuation">[</span>dates <span class="token operator">==</span> month<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> month <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    mu <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>monthly_means<span class="token punctuation">)</span><span class="token punctuation">[</span>dates <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    sd <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>monthly_sds<span class="token punctuation">)</span><span class="token punctuation">[</span>dates <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>data <span class="token operator">-</span> mu<span class="token punctuation">)</span> <span class="token operator">/</span> sd
    
<span class="token comment"># Temperature data for location</span>
temper_dates <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># months</span>

temper_loc <span class="token operator">=</span> temp_ds<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">'air'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> idxLat<span class="token punctuation">,</span> idxLon<span class="token punctuation">]</span>
temper_loc_norm <span class="token operator">=</span> normalize_data<span class="token punctuation">(</span>temper_loc<span class="token punctuation">,</span> temper_dates<span class="token punctuation">)</span>

<span class="token comment"># Precipitable water data for location</span>
water_loc <span class="token operator">=</span> water_ds<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">'pr_wtr'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> idxLat<span class="token punctuation">,</span> idxLon<span class="token punctuation">]</span>
water_loc_norm <span class="token operator">=</span> normalize_data<span class="token punctuation">(</span>water_loc<span class="token punctuation">,</span> temper_dates<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">n_points <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>temper_loc_norm<span class="token punctuation">)</span>  <span class="token comment"># or 541 if you are working with fixed length</span>

<span class="token comment"># Create a figure and a set of subplots</span>
fig<span class="token punctuation">,</span> axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Plot normalized temperature data in the first subplot</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>n_points<span class="token punctuation">)</span><span class="token punctuation">,</span> temper_loc_norm<span class="token punctuation">,</span> edgecolors<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> facecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Temperature'</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Normalized Temperature Data for Miami, FL'</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Plot normalized precipitable water data in the second subplot</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>n_points<span class="token punctuation">)</span><span class="token punctuation">,</span> water_loc_norm<span class="token punctuation">,</span> edgecolors<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> facecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Precipitable Water'</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Normalized Precipitable Water Data for Miami, FL'</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Adjust layout to prevent overlapping</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Show the plot</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/twater.png"></p><p>check for bivariable relationship:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>temper_loc_norm<span class="token punctuation">,</span> water_loc_norm<span class="token punctuation">,</span> edgecolors<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> facecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'temper_loc_norm'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'water_loc_norm'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/twater2.png"></p><h3 id="Determine-Copula-by-ploting-empirical-Copula"><a href="#Determine-Copula-by-ploting-empirical-Copula" class="headerlink" title="Determine Copula by ploting empirical Copula"></a>Determine Copula by ploting empirical Copula</h3><p>check the distribution for each variable:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">fig<span class="token punctuation">,</span> axs <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>hist<span class="token punctuation">(</span>temper_loc_norm<span class="token punctuation">,</span> bins <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Normalized Temperature'</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'frequency'</span><span class="token punctuation">)</span>

axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>hist<span class="token punctuation">(</span>water_loc_norm<span class="token punctuation">,</span> bins <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Normalized Precipitable Water'</span><span class="token punctuation">)</span>
axs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'frequency'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/twaterdis.png"></p><p>For convenience, we naively treat air temperature and precipitable water as normal distribution with $\mu &#x3D; 0$ and $\sigma &#x3D; 1$ (since we normalized data before).</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> expon<span class="token punctuation">,</span> norm

mu <span class="token operator">=</span> <span class="token number">0</span>
sigma <span class="token operator">=</span> <span class="token number">1</span>
U <span class="token operator">=</span> norm<span class="token punctuation">.</span>cdf<span class="token punctuation">(</span>temper_loc_norm<span class="token punctuation">,</span> loc<span class="token operator">=</span>mu<span class="token punctuation">,</span> scale<span class="token operator">=</span>sigma<span class="token punctuation">)</span>
V <span class="token operator">=</span> norm<span class="token punctuation">.</span>cdf<span class="token punctuation">(</span>water_loc_norm<span class="token punctuation">,</span> loc<span class="token operator">=</span>mu<span class="token punctuation">,</span> scale<span class="token operator">=</span>sigma<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>U<span class="token punctuation">,</span> V<span class="token punctuation">,</span> edgecolors<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> facecolors<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'temperature'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'water'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/empCopu.png"></p><p>Now, as a Copula expert, which copula would you recommend (from Gaussian, Frank and Clayton)?</p><p>Yes, <strong>Frank</strong>!</p><h3 id="Fit-Copula-and-quantile-regression"><a href="#Fit-Copula-and-quantile-regression" class="headerlink" title="Fit Copula and quantile regression"></a>Fit Copula and quantile regression</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> expon<span class="token punctuation">,</span> norm
<span class="token keyword">from</span> copulas<span class="token punctuation">.</span>bivariate <span class="token keyword">import</span> Bivariate<span class="token punctuation">,</span> CopulaTypes

empCopula <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>U<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">)</span>

frank <span class="token operator">=</span> Bivariate<span class="token punctuation">(</span>copula_type<span class="token operator">=</span>CopulaTypes<span class="token punctuation">.</span>FRANK<span class="token punctuation">)</span>
frank<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>empCopula<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> rankdata

theta <span class="token operator">=</span> frank<span class="token punctuation">.</span>theta
nTime <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>temper_dates<span class="token punctuation">)</span>

tempRanks <span class="token operator">=</span> rankdata<span class="token punctuation">(</span>temper_loc_norm<span class="token punctuation">)</span> <span class="token operator">/</span> nTime

<span class="token keyword">def</span> <span class="token function">calculate_bound</span><span class="token punctuation">(</span>ranks<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> theta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token operator">-</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> alpha <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>theta<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>theta <span class="token operator">*</span> ranks<span class="token punctuation">)</span> <span class="token operator">+</span> alpha <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>theta <span class="token operator">*</span> ranks<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> theta

<span class="token comment"># Calculating bounds for different alpha values</span>
alpha_low<span class="token punctuation">,</span> alpha_high<span class="token punctuation">,</span> alpha_mid <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">,</span> <span class="token number">0.5</span>
lowBoundWater <span class="token operator">=</span> calculate_bound<span class="token punctuation">(</span>tempRanks<span class="token punctuation">,</span> alpha_low<span class="token punctuation">,</span> theta<span class="token punctuation">)</span>
highBoundWater <span class="token operator">=</span> calculate_bound<span class="token punctuation">(</span>tempRanks<span class="token punctuation">,</span> alpha_high<span class="token punctuation">,</span> theta<span class="token punctuation">)</span>
midBoundWater <span class="token operator">=</span> calculate_bound<span class="token punctuation">(</span>tempRanks<span class="token punctuation">,</span> alpha_mid<span class="token punctuation">,</span> theta<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">tempRanks <span class="token operator">=</span> rankdata<span class="token punctuation">(</span>temper_loc_norm<span class="token punctuation">)</span> <span class="token operator">/</span> nTime
waterRanks <span class="token operator">=</span> rankdata<span class="token punctuation">(</span>water_loc_norm<span class="token punctuation">)</span> <span class="token operator">/</span> nTime

<span class="token comment"># Identify anomalous indices based on your conditions</span>
anomLowWaterIdx <span class="token operator">=</span> <span class="token punctuation">(</span>waterRanks <span class="token operator">&lt;</span> lowBoundWater<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>tempRanks <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span>
anomHighWaterIdx <span class="token operator">=</span> <span class="token punctuation">(</span>waterRanks <span class="token operator">></span> highBoundWater<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>tempRanks <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span>

<span class="token comment"># Plot</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>tempRanks<span class="token punctuation">,</span> waterRanks<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">)</span>  <span class="token comment"># Base data</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>tempRanks<span class="token punctuation">,</span> lowBoundWater<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"orange"</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># Low bound</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>tempRanks<span class="token punctuation">,</span> highBoundWater<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"orange"</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># High bound</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>tempRanks<span class="token punctuation">,</span> midBoundWater<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"green"</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token comment"># Mid bound</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>tempRanks<span class="token punctuation">[</span>anomLowWaterIdx<span class="token punctuation">]</span><span class="token punctuation">,</span> waterRanks<span class="token punctuation">[</span>anomLowWaterIdx<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Anomalous'</span><span class="token punctuation">)</span>  <span class="token comment"># Anomalous low</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>tempRanks<span class="token punctuation">[</span>anomHighWaterIdx<span class="token punctuation">]</span><span class="token punctuation">,</span> waterRanks<span class="token punctuation">[</span>anomHighWaterIdx<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">)</span>  <span class="token comment"># Anomalous high</span>

plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Temperature'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Water Rank'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Temperature vs. Water Content'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/en/../images/6/anomal.png"></p><p>This result is great because quantile regression can reveal the interdependency between two variables rather than simply treating them independent. Therefore, different from naïve linear model or manually set a quantile range to detect anomalies, Copula is able to give us a reasonable sensitivity to anomalies, not too high or too low.</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Wow, we finished Copula in three lessons 😇. Copula, amazing.</p><p>I studied Copulas last quarter in the Linear &amp; Nonlinear class, and in the final week, we asked our professor which topic was his favorite in this class. He said that everyone and every topic is like his child, but if he had to pick one favorite topic, it would be Copulas. That evening, we ventured into a cozy bar, our hands cradling cups brimming with delicious drinks, as we gathered in a welcoming space, exchanging tales. It was a night of splendid camaraderie and a tribute to our remarkable professor.</p><p>Copulas have a wide range of applications across numerous fields. Beyond their use in anomaly detection within environmental studies, they are also pivotal in finance, insurance, and more. In essence, if the goal is to analyze multivariate nonlinear relationships, Copulas often emerge as the go-to methodology.</p><p>Thank you, and see you next time.</p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">Author:</i></span> <span class="reprint-info"><a href="/en/about" rel="external nofollow noreferrer">Chupeng Zheng</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">Link:</i></span> <span class="reprint-info"><a href="https://zcpisme.github.io/en/2024/03/17/6_2024-03-15-CopulasIII-Application/">https://zcpisme.github.io/en/2024/03/17/6_2024-03-15-CopulasIII-Application/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">Reprint policy:</i></span> <span class="reprint-info">All articles in this blog are used except for special statements <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> reprint policy. If reproduced, please indicate source <a href="/en/about" target="_blank">Chupeng Zheng</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/en/tags/Probability/"><span class="chip bg-color">Probability</span></a> <a href="/en/tags/Mathematics/"><span class="chip bg-color">Mathematics</span></a> <a href="/en/tags/Machine-Learning/"><span class="chip bg-color">Machine Learning</span></a> <a href="/en/tags/Linear-Nonlinear-Analysis/"><span class="chip bg-color">Linear &amp; Nonlinear Analysis</span></a> <a href="/en/tags/Data-Analysis/"><span class="chip bg-color">Data Analysis</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="/en/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/en/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/en/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/en/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="far fa-dot-circle"></i> &nbsp;Current</div><div class="card"><a href="/en/2024/03/17/6_2024-03-15-CopulasIII-Application/"><div class="card-image"><img src="/en/medias/featureimages/16.jpg" class="responsive-img" alt="Copula III — Applications"> <span class="card-title">Copula III — Applications</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2024-03-17</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/en/categories/Mathematics/" class="post-category">Mathematics</a></span></div></div><div class="card-action article-tags"><a href="/en/tags/Probability/"><span class="chip bg-color">Probability</span></a> <a href="/en/tags/Mathematics/"><span class="chip bg-color">Mathematics</span></a> <a href="/en/tags/Machine-Learning/"><span class="chip bg-color">Machine Learning</span></a> <a href="/en/tags/Linear-Nonlinear-Analysis/"><span class="chip bg-color">Linear &amp; Nonlinear Analysis</span></a> <a href="/en/tags/Data-Analysis/"><span class="chip bg-color">Data Analysis</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">Next&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/en/2024/03/15/5_2024-03-13-CopulasII-Definition/"><div class="card-image"><img src="/en/medias/featureimages/13.jpg" class="responsive-img" alt="Copula II — Definition"> <span class="card-title">Copula II — Definition</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2024-03-15</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/en/categories/Mathematics/" class="post-category">Mathematics</a></span></div></div><div class="card-action article-tags"><a href="/en/tags/Probability/"><span class="chip bg-color">Probability</span></a> <a href="/en/tags/Mathematics/"><span class="chip bg-color">Mathematics</span></a> <a href="/en/tags/Machine-Learning/"><span class="chip bg-color">Machine Learning</span></a> <a href="/en/tags/Linear-Nonlinear-Analysis/"><span class="chip bg-color">Linear &amp; Nonlinear Analysis</span></a></div></div></div></div></article></div><script src="/en/libs/codeBlock/codeBlockFuction.js"></script><script src="/en/libs/prism/prism.min.js"></script><script src="/en/libs/codeBlock/codeLang.js"></script><script src="/en/libs/codeBlock/codeCopy.js"></script><script src="/en/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/en/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})</script><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2024</span> <a href="/en/about" target="_blank">Chupeng Zheng</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span></span> <span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t="2024",n=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),r=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),g=Date.UTC(t,"3","3","0","0","0"),d=Date.UTC(n,i,a,r,s,o)-g,m=Math.floor(d/31536e6),l=Math.floor(d/864e5-365*m);if(t===String(n)){document.getElementById("year").innerHTML=n;var c="This site has been running for "+l+" days";0,document.getElementById("sitetime").innerHTML=c}else{document.getElementById("year").innerHTML=t+" - "+n;var u="This site has been running for "+m+" years and "+l+" days";0,document.getElementById("sitetime").innerHTML=u}};calcSiteTime()</script><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/zcpisme" class="tooltipped" target="_blank" data-tooltip="Visit My GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="https://www.linkedin.com/in/chupeng-zheng-858348211/" class="tooltipped" target="_blank" data-tooltip="Visit My LinkedIn" data-position="top" data-delay="50"><i class="fab fa-linkedin"></i></a><a href="mailto:zhengcpcp00@outlook.com" class="tooltipped" target="_blank" data-tooltip="Email Me" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;Search</span> <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){!function(t,a,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),r=document.getElementById(a),n=document.getElementById(s);r.addEventListener("input",function(){var f='<ul class="search-result-list">',m=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var r=!0,n=t.title.trim().toLowerCase(),a=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),e=t.url;e=0===e.indexOf("/")?t.url:"/"+e;var s=-1,i=-1,l=-1;if(""!==n&&""!==a&&m.forEach(function(t,e){s=n.indexOf(t),i=a.indexOf(t),s<0&&i<0?r=!1:(i<0&&(i=0),0===e&&(l=i))}),r){f+="<li><a href='"+e+"' class='search-result-title'>"+n+"</a>";var c=t.content.trim().replace(/<[^>]+>/g,"");if(0<=l){var u=l-20,o=l+80;u<0&&(u=0),0===u&&(o=100),o>c.length&&(o=c.length);var h=c.substr(u,o);m.forEach(function(t){var e=new RegExp(t,"gi");h=h.replace(e,'<em class="search-keyword">'+t+"</em>")}),f+='<p class="search-result">'+h+"...</p>"}f+="</li>"}}),f+="</ul>",n.innerHTML=f)})}})}("/en/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/en/libs/materialize/materialize.min.js"></script><script src="/en/libs/masonry/masonry.pkgd.min.js"></script><script src="/en/libs/aos/aos.js"></script><script src="/en/libs/scrollprogress/scrollProgress.min.js"></script><script src="/en/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/en/js/matery.js"></script><script src="https://ssl.captcha.qq.com/TCaptcha.js"></script><script src="/en/libs/others/TencentCaptcha.js"></script><button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/en/libs/others/clicklove.js" async></script><script async src="/en/libs/others/busuanzi.pure.mini.js"></script><script src="/en/libs/instantpage/instantpage.js" type="module"></script></body></html>